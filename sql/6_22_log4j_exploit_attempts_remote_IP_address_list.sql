  SELECT
    httpRequest.remoteIp,
    ARRAY_AGG(DISTINCT httpRequest.requestMethod) AS requestMethods,
    ARRAY_AGG(DISTINCT resource.labels.backend_service_name) AS backend_service_names,
    ARRAY_AGG(DISTINCT httpRequest.status) AS statuses,
    ARRAY_AGG(DISTINCT jsonpayload_type_loadbalancerlogentry.statusdetails) AS statusdetails,
    COUNT(*) AS counter
  FROM `[MY_DATASET_ID].[MY_PROJECT_ID].requests`
  WHERE
    timestamp >= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 30 DAY)
    AND resource.type="http_load_balancer"
    AND (
     REGEXP_CONTAINS(httpRequest.requestUrl, r'(?i)(\$|\%24)(\{|\%7b).*j.*n.*d.*i.*(\:|\%3a)')
     OR REGEXP_CONTAINS(httpRequest.userAgent, r'(?i)(\$|\%24)(\{|\%7b).*j.*n.*d.*i.*(\:|\%3a)')
     OR REGEXP_CONTAINS(httpRequest.referer, r'(?i)(\$|\%24)(\{|\%7b).*j.*n.*d.*i.*(\:|\%3a)')
    )
  GROUP BY
    httpRequest.remoteIp
  ORDER BY
    counter DESC